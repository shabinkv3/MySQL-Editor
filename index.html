<!DOCTYPE html>
<html>
  <head>
    <title>Auto complete using Pure Javascript</title>
  </head>
  <body>
    <script type="text/javascript">
      keywords = [
        "INSERT",
        "INTO",
        "VALUES(",
        ")",
        "ORDER",
        "BY",
        "SELECT",
        "FROM",
        "WHERE",
        "ASC",
        "DESC",
        "*",
        "VALUES",
        "AS",
        "AVG(",
        "MIN(",
        "MAX(",
        "COUNT(*)",
        "COUNT(",
        "GROUP",
        "HAVING",
        "IN",
        "DISTINCT",
        "NOT",
        "EXISTS",
        "DELETE",
        "UPDATE",
        "SET",
      ];

      var tags = [];

      /*list of available options*/

      function getCombine(s1, s2) {
        var i,
          no_of_seps = 0,
          finalString = "",
          queryList = [];
        var wordList = s2.split(",");
        //console.log(wordList);
        // for(i=0;i<s1.length;i++){
        //     if(s1[i]=='^'){
        //         no_of_seps++;
        //     }
        // }
        // // console.log(no_of_seps);
        var queryList = s1.split("^");
        // for(i=0;i<stringSplit.length;i++){
        //     queryList.push(stringSplit[i]);
        // }
        // console.log(queryList);
        if (queryList.length == wordList.length) {
          for (i = 0; i < no_of_seps; i++) {
            finalString += queryList[i];
            finalString += wordList[i];
          }
          finalString += queryList[i];
        } else {
          for (i = 0; i < wordList.length; i++) {
            finalString += queryList[i];
            finalString += wordList[i];
          }
          while (i != queryList.length) {
            finalString += queryList[i++];
          }
        }
        console.log(finalString);
      }

      function get(url, entered, callback) {
        console.log(preprocess(entered, keywords));
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function () {
          if (this.readyState == 4) {
            callback(this.responseText);
          }
        };
        xmlhttp.open("GET", url + preprocess(entered, keywords), true);
        xmlhttp.setRequestHeader(
          "Content-type",
          "application/x-www-form-urlencoded"
        );
        xmlhttp.send();
      }

      function handle(data) {
        myObj = JSON.parse(data).matching;
        document.getElementById("datalist").innerHTML = "";
        //setting datalist empty at the start of function
        //if we skip this step, same name will be repeated

        //input query length

        tags = myObj;
        n = tags.length;

        for (var i = 0; i < n; i++) {
          //comparing if input string is existing in tags[i] string

          var node = document.createElement("option");
          var val = document.createTextNode(tags[i]);
          node.appendChild(val);

          document.getElementById("datalist").appendChild(node);
          console.log(document.getElementById("datalist").innerHTML);
          //creating and appending new elements in data list
        }
      }
      function split(inp_text) {
        // WORD SPLITTER

        inp_text = inp_text.concat(" ");
        words = [];
        word = "";
        paranthesis = 0;

        for (letter of inp_text) {
          if ((letter == " " || letter == "\n") && paranthesis == 0) {
            if (word != "") words.push(word);
            word = "";
            continue;
          }

          if (letter == "(") {
            if (paranthesis == 0) {
              if (word != "") {
                words.push(word.concat("("));
                word = "";
              } else {
                words[words.length - 1] = words[words.length - 1].concat("(");
              }
              paranthesis++;
              continue;
            }
            paranthesis++;
          }

          if (letter == ")") {
            paranthesis--;
            if (paranthesis == 0) {
              if (word != "") {
                words.push(word);
                word = "";
                words.push(")");
                continue;
              }
              words.push(")");
            }
          }

          word = word.concat(letter);
        }
        return words;
      }

      function preprocess(inp_text, keywords_array) {
        var words = split(inp_text);
        for (var i = 0; i < words.length; i++) {
          if (!keywords_array.includes(words[i].toUpperCase())) {
            words[i] = "^";
          }
        }

        processed_string = words.join(" ");
        return processed_string;
      }
    </script>

    <input
      type="text"
      list="datalist"
      onInput="if(this.value.length>0) {get('http://localhost:9000/queries/query?q=',this.value,handle)}"
    />
    <!-- On keyup calls the function everytime a key is released -->
    <datalist id="datalist">
      <!-- This data list will be edited through javascript	 -->
    </datalist>
  </body>
</html>
